<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verify your RHOSP18 and Ceph Storage cluster deployment :: Ceph Installation and Integration with RedHat OpenStack 18</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Ceph Installation and Integration with RedHat OpenStack 18</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/changeme/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="rhoso-ceph" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Ceph Installation and Integration with RedHat OpenStack 18</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Ceph Storage Cluster Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Verify lab environment connectivity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Install packages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section3.html">Configuration files on the deployment server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section4.html">Deploy the Ceph storage cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section5.html">Verify deployed cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section6.html">Create storage pool</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Integration of Ceph storage cluster with Red Hat OpenStack 18</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section1.html">Verify your RHOSP18 and Ceph Storage cluster deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Delete Dataplane and Controlplane deployment of RHOSP18 cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Configure the Ceph storage cluster for RHOSP storage requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section4.html">Install OpenShift Data Foundation operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section5.html">Create ODF StorageSystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section6.html">Storage class installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section7.html">Configure controlplane to use redhat ceph storage cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section8.html">Deploy OpenStack control plane and verify the installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section9.html">Deploy OpenStack dataplane and verify its status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section10.html">Verify RHOSO Ceph integration setup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix A</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ceph Installation and Integration with RedHat OpenStack 18</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Ceph Installation and Integration with RedHat OpenStack 18</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Ceph Installation and Integration with RedHat OpenStack 18</a></li>
    <li><a href="index.html">Integration of Ceph storage cluster with Red Hat OpenStack 18</a></li>
    <li><a href="section1.html">Verify your RHOSP18 and Ceph Storage cluster deployment</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Verify your RHOSP18 and Ceph Storage cluster deployment</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to the <code>utility</code> VM and switch to <code>lab</code> user.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh utility</code></pre>
</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo su - lab</code></pre>
</div>
</div>
<div class="paragraph">
<p>When prompted, provide the password for the student user as <code>student</code></p>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ ssh utility
__output trimmed__
[student@utility ~]$
[student@utility ~]$ sudo su - lab
[sudo] password for student:
Last login: Wed Jun 26 11:37:44 EDT 2024 from 172.25.250.254 on pts/3
[lab@utility ~]$</pre>
</div>
</div>
</li>
<li>
<p>Enable tab completion for <code>oc</code> command for convenience of use.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc completion bash &gt; /tmp/oc
sudo cp /tmp/oc /etc/bash_completion.d/
source /etc/bash_completion.d/oc</code></pre>
</div>
</div>
</li>
<li>
<p>Verify deployment status of OpenStack controlplane.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get -n openstack openstackcontrolplanes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[lab@utility ~]$ oc get -n openstack openstackcontrolplanes
NAME                                 STATUS   MESSAGE
openstack-galera-network-isolation   True     Setup complete</pre>
</div>
</div>
</li>
<li>
<p>Verify deployment status of OpenStack dataplane</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get -n openstack openstackdataplanedeployments</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[lab@utility ~]$ oc get -n openstack openstackdataplanedeployments
NAME                  NODESETS                  STATUS   MESSAGE
openstack-edpm-ipam   ["openstack-edpm-ipam"]   True     Setup complete
[lab@utility ~]$</pre>
</div>
</div>
</li>
<li>
<p>Check the storage class being used by the existing persistent volume claims.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">for pvc in `oc get pvc -o NAME`; do  oc get $pvc -o custom-columns=NAME:.metadata.name,STORAGECLASS:.spec.storageClassName; done</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[lab@utility ~]$ for pvc in `oc get pvc -o NAME`; do  oc get $pvc -o custom-columns=NAME:.metadata.name,STORAGECLASS:.spec.storageClassName; done
NAME                             STORAGECLASS
glance-glance-default-single-0   nfs
NAME                                STORAGECLASS
mysql-db-openstack-cell1-galera-0   nfs-storage
NAME                          STORAGECLASS
mysql-db-openstack-galera-0   nfs-storage
NAME                                       STORAGECLASS
ovndbcluster-nb-etc-ovn-ovsdbserver-nb-0   nfs-storage
NAME                                       STORAGECLASS
ovndbcluster-sb-etc-ovn-ovsdbserver-sb-0   nfs-storage
NAME                                  STORAGECLASS
persistence-rabbitmq-cell1-server-0   nfs-storage
NAME                            STORAGECLASS
persistence-rabbitmq-server-0   nfs-storage</pre>
</div>
</div>
<div class="paragraph">
<p>Note that all the pvcs are using nfs storage class.</p>
</div>
</li>
<li>
<p>Access openstack client.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc rsh openstackclient</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[lab@utility ~]$ oc rsh openstackclient
sh-5.1$</pre>
</div>
</div>
</li>
<li>
<p>Check openstack compute service list to make sure all required services are up and running.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openstack compute service list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>sh-5.1$ openstack compute service list
+--------------------------------------+----------------+----------------------------+----------+---------+-------+----------------------------+
| ID                                   | Binary         | Host                       | Zone     | Status  | State | Updated At                 |
+--------------------------------------+----------------+----------------------------+----------+---------+-------+----------------------------+
| 323e5a53-17d2-4d15-aaf4-ac771426256f | nova-conductor | nova-cell0-conductor-0     | internal | enabled | up    | 2024-07-10T16:16:24.000000 |
| a43a93ed-1c81-47ee-b8ee-7a13a293df46 | nova-scheduler | nova-scheduler-0           | internal | enabled | up    | 2024-07-10T16:16:25.000000 |
| 286eca12-36e0-4fc6-a2a4-21afbe2ad6c6 | nova-conductor | nova-cell1-conductor-0     | internal | enabled | up    | 2024-07-10T16:16:25.000000 |
| a5242fc4-48d3-4afb-a586-f08b55460d2c | nova-compute   | compute01.ocp4.example.com | nova     | enabled | up    | 2024-07-10T16:16:26.000000 |
| 4c2bcee4-fccb-4b5c-9ab2-5f5397cf8022 | nova-compute   | compute02.ocp4.example.com | nova     | enabled | up    | 2024-07-10T16:16:29.000000 |
+--------------------------------------+----------------+----------------------------+----------+---------+-------+----------------------------+</pre>
</div>
</div>
</li>
<li>
<p>Check hypervisor list and verify compute nodes are recognized there.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openstack hypervisor list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>sh-5.1$ openstack hypervisor list
+--------------------------------------+---------------------------+-----------------+--------------+-------+
| ID                                   | Hypervisor Hostname       | Hypervisor Type | Host IP      | State |
+--------------------------------------+---------------------------+-----------------+--------------+-------+
| e4cb88d4-4457-47e2-93de-7b89db3d65fa | compute01.srv.example.com | QEMU            | 172.22.0.110 | up    |
| b1ead9bc-7a3e-4ebf-baff-db0ced1626aa | compute02.srv.example.com | QEMU            | 172.22.0.111 | up    |
+--------------------------------------+---------------------------+-----------------+--------------+-------+</pre>
</div>
</div>
</li>
<li>
<p>Check openstack network agent list and verify its status.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openstack network agent list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>sh-5.1$ openstack network agent list
+--------------------------------------+------------------------------+----------------------------+-------------------+-------+-------+----------------------------+
| ID                                   | Agent Type                   | Host                       | Availability Zone | Alive | State | Binary                     |
+--------------------------------------+------------------------------+----------------------------+-------------------+-------+-------+----------------------------+
| e3fceae4-b235-449a-907d-5833d1fb1c5f | OVN Controller agent         | compute02.ocp4.example.com |                   | :-)   | UP    | ovn-controller             |
| dc835235-666f-53ae-b54d-b3b8b6171577 | OVN Metadata agent           | compute02.ocp4.example.com |                   | :-)   | UP    | neutron-ovn-metadata-agent |
| 37854ce7-d1c3-42aa-a7f9-55a1b5c100d1 | OVN Controller agent         | compute01.ocp4.example.com |                   | :-)   | UP    | ovn-controller             |
| 3af6cb3a-0d20-52a4-b8c8-344a38fc2eef | OVN Metadata agent           | compute01.ocp4.example.com |                   | :-)   | UP    | neutron-ovn-metadata-agent |
| 6c2fd347-2db2-4957-8dd3-fbc05f12378a | OVN Controller Gateway agent | master02                   |                   | :-)   | UP    | ovn-controller             |
| 8b07207e-c8b1-411a-90f4-738c36abb5ae | OVN Controller Gateway agent | master03                   |                   | :-)   | UP    | ovn-controller             |
| 8ede615b-5466-4973-9b7d-e4766ef5e238 | OVN Controller Gateway agent | master01                   |                   | :-)   | UP    | ovn-controller             |
+--------------------------------------+------------------------------+----------------------------+-------------------+-------+-------+----------------------------+</pre>
</div>
</div>
</li>
<li>
<p>Run below set of commands to launch an instance</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export GATEWAY=192.168.51.254
export PUBLIC_NETWORK_CIDR=192.168.51.0/24
export PRIVATE_NETWORK_CIDR=192.168.100.0/24
export PUBLIC_NET_START=192.168.51.91
export PUBLIC_NET_END=192.168.51.99
export DNS_SERVER=8.8.8.8
openstack flavor create --ram 512 --disk 1 --vcpu 1 --public tiny
curl -O -L https://github.com/cirros-dev/cirros/releases/download/0.6.2/cirros-0.6.2-x86_64-disk.img
openstack image create cirros --container-format bare --disk-format qcow2 --public --file cirros-0.6.2-x86_64-disk.img
openstack security group create basic
openstack security group rule create basic --protocol tcp --dst-port 22:22 --remote-ip 0.0.0.0/0
openstack security group rule create --protocol icmp basic
openstack security group rule create --protocol udp --dst-port 53:53 basic
openstack network create --external --provider-physical-network datacentre --provider-network-type flat public
openstack network create --internal private
openstack subnet create public-net \
--subnet-range $PUBLIC_NETWORK_CIDR \
--no-dhcp \
--gateway $GATEWAY \
--allocation-pool start=$PUBLIC_NET_START,end=$PUBLIC_NET_END \
--network public
openstack subnet create private-net \
--subnet-range $PRIVATE_NETWORK_CIDR \
--network private
openstack router create vrouter
openstack router set vrouter --external-gateway public
openstack router add subnet vrouter private-net
openstack server create \
    --flavor tiny --network private --security-group basic \
    --image cirros test-server</code></pre>
</div>
</div>
</li>
<li>
<p>Watch the status of the openstack instance</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">watch openstack server list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>Every 2.0s: openstack server list                                                                           openstackclient: Fri Jul 12 15:44:47 2024

+--------------------------------------+-------------+--------+------------------------+--------+--------+
| ID                                   | Name        | Status | Networks               | Image  | Flavor |
+--------------------------------------+-------------+--------+------------------------+--------+--------+
| a46bb17f-82c9-4f0e-b14b-382c30b691c6 | test-server | ACTIVE | private=192.168.100.94 | cirros | tiny   |
+--------------------------------------+-------------+--------+------------------------+--------+--------+</pre>
</div>
</div>
<div class="paragraph">
<p>Press <code>Ctrl+C</code> to exit from watch and then run <code>exit</code> command to quit from openstackclient session.</p>
</div>
</li>
<li>
<p>From utility vm login to the <code>cephservera</code> vm.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh root@cephservera</code></pre>
</div>
</div>
</li>
<li>
<p>Check status of the ceph server deployed in previous lab.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph -s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[lab@utility ~]$ ssh root@cephservera
[root@cephservera ~]# ceph -s
  cluster:
    id:     d7956744-3ed0-11ef-a8fc-5254000132d3
    health: HEALTH_OK

  services:
    mon: 5 daemons, quorum cephservera,cephservere,cephserverc,cephserverd,cephserverb (age 2h)
    mgr: cephservera.kiifxv(active, since 2h), standbys: cephserverd.vklfcr, cephserverb.takrdm, cephserverc.kftfon
    osd: 20 osds: 20 up (since 2h), 20 in (since 2h)
    rgw: 2 daemons active (2 hosts, 1 zones)

  data:
    pools:   6 pools, 161 pgs
    objects: 205 objects, 17 MiB
    usage:   1.4 GiB used, 198 GiB / 200 GiB avail
    pgs:     161 active+clean</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure health is <code>HEALTH_OK</code> in the status output.</p>
</div>
</li>
<li>
<p>Capture the usage of ceph storage server in one file.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph df &gt; ceph-df.0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will need this file later to verify the usage of ceph storage cluster after integration with RHOSP.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Exit from <code>cephservera</code> to be back on <code>utility</code> vm.</p>
</li>
</ol>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Integration of Ceph storage cluster with Red Hat OpenStack 18</a></span>
  <span class="next"><a href="section2.html">Delete Dataplane and Controlplane deployment of RHOSP18 cluster</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
